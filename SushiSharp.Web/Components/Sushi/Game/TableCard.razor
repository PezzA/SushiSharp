@using SushiSharp.Cards
@using Microsoft.AspNetCore.Mvc.Filters
@using SushiSharp.Web.Setup

<div
    class="sushi-card @CardClass() @State()"
    style="width:@(BoardSettings.CardWidth)px; height:@(BoardSettings.CardHeight)px; left:@(Left - BoardSettings.ScaledCardWidthOffSet)px;top: @(Top - BoardSettings.ScaledCardHeightOffSet)px; transform: scale(@BoardSettings.CardScale)"
    @onclick="ClickCard">
</div>

@code {
    [Parameter] public required Card SushiTableCard { get; set; }
    [Parameter] public required int Left { get; set; }
    [Parameter] public required int Top { get; set; }
    [Parameter] public required bool CanSelect { get; set; }
    [Parameter] public required bool IsPicked { get; set; }
    [Parameter] public bool ViewOnly { get; set; }
    [Parameter] public EventCallback<TableCardSelectArgs> SelectChange { get; set; }

    private string State()
    {
        if (ViewOnly) return string.Empty;
        
        if (!CanSelect && !IsPicked) return "dimmed";

        return IsPicked
            ? "selected"
            : "grow";
    }

    private string CardClass()
    {
        return SushiTableCard.Type switch
        {
            CardType.MakiRolls => SushiTableCard.Symbols.Length switch
            {
                1 => "maki-1",
                2 => "maki-2",
                3 => "maki-3",
                _ => string.Empty
            },
            CardType.Nagiri => SushiTableCard.Symbols[0] switch
            {
                CardSymbol.NagiriEgg => "egg-nagiri",
                CardSymbol.NagiriSalmon => "salmon-nagiri",
                CardSymbol.NagiriSquid => "squid-nagiri",
                _ => string.Empty
            },
            _ => SushiTableCard.Type switch
            {
                CardType.Tempura => "tempura",
                CardType.Sashimi => "sashimi",
                CardType.Pudding => "pudding",
                CardType.Wasabi => "wasabi",
                CardType.Chopsticks => "chopsticks",
                CardType.Dumpling => "dumpling",
                _ => string.Empty
            }
        };
    }

    private async Task ClickCard()
    {
        if (!CanSelect && !IsPicked) return;

        IsPicked = !IsPicked;

        await SelectChange.InvokeAsync(new TableCardSelectArgs{Selected = IsPicked, Card = SushiTableCard});
    }

    public class TableCardSelectArgs
    {
        public bool Selected { get; set; }
        public required Card Card {get; set; }
    }
}